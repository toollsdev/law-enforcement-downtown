<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema Integrado - Polícia</title>
    <style>
      :root {
        --primary: #5865f2;
        --primary-hover: #4752c4;
        --success: #3ba55d;
        --bg-dark: #36393f;
        --bg-card: #2f3136;
        --bg-nav: #202225;
        --text-main: #dcddde;
        --text-muted: #b9bbbe;
        --input-bg: #202225;
        --border: #4f545c;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--bg-dark);
        color: var(--text-main);
        margin: 0;
        padding: 0;
        padding-top: 80px;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
      }

      .navbar {
        width: 100%;
        height: 60px;
        background-color: var(--bg-nav);
        display: flex;
        justify-content: center;
        align-items: center;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 1000;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
      }

      .nav-container {
        width: 100%;
        max-width: 1200px;
        display: flex;
        justify-content: space-around;
        list-style: none;
        margin: 0;
        padding: 0;
      }

      .nav-container li a {
        color: var(--text-muted);
        text-decoration: none;
        font-weight: 600;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        padding: 10px 15px;
        border-radius: 4px;
        cursor: pointer;
        transition: 0.3s;
      }

      .nav-container li a:hover, .nav-container li a.active {
        color: #fff;
        background: rgba(255, 255, 255, 0.05);
      }

      .nav-container li a.active {
        color: var(--primary);
        border-bottom: 2px solid var(--primary);
        border-radius: 0;
      }

      .card {
        background-color: var(--bg-card);
        width: 100%;
        max-width: 480px;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        margin-bottom: 40px;
        display: none;
      }

      .card.active {
        display: block;
      }

      h2 { text-align: center; color: #fff; margin-bottom: 1.5rem; }
      h3 { border-bottom: 1px solid var(--border); padding-bottom: 5px; color: var(--primary); font-size: 1rem; margin-top: 25px; }

      .form-group { margin-bottom: 15px; }
      label { display: block; font-size: 0.75rem; font-weight: bold; color: var(--text-muted); text-transform: uppercase; margin-bottom: 8px; }

      input, select, textarea {
        width: 100%; padding: 10px; border-radius: 4px; border: none;
        background-color: var(--input-bg); color: #fff; box-sizing: border-box; margin-top: 5px;
      }

      .input-row { display: flex; gap: 8px; margin-top: 8px; }

      .photo-area {
        width: 100%;
        min-height: 120px;
        border: 2px dashed var(--border);
        border-radius: 8px;
        margin-top: 10px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        color: var(--text-muted);
        overflow: hidden;
        transition: 0.3s;
        text-align: center;
        padding: 10px;
      }

      .photo-area:hover { border-color: var(--primary); background: rgba(88, 101, 242, 0.05); }
      .photo-area img { max-width: 100%; max-height: 250px; border-radius: 4px; }

      .btn-now { background: #4f545c; color: white; border: none; padding: 0 10px; border-radius: 4px; cursor: pointer; font-size: 0.7rem; text-transform: uppercase; }
      .btn-group { display: flex; gap: 10px; margin-top: 20px; }
      button.main-btn { flex: 1; padding: 12px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; transition: 0.3s; color: white; }
      .btn-generate { background-color: var(--primary); }
      .btn-add { background-color: #4f545c; margin-top: 10px; width: 100%; padding: 10px; border-radius: 4px; border: none; color: white; cursor: pointer; font-weight: bold; }
      .btn-copy { background-color: var(--success); }

      .arma-item {
        background: rgba(0,0,0,0.2);
        padding: 10px;
        border-radius: 4px;
        margin-top: 10px;
        border-left: 4px solid var(--primary);
        font-size: 0.85rem;
      }

      .result-area { height: 120px; color: #85d296; font-family: 'Courier New', monospace; resize: none; border: 1px solid #202225; margin-top: 20px; }
      .footer { text-align: center; font-size: 0.7rem; color: var(--text-muted); padding: 20px; }
    </style>
  </head>
  <body onload="definirHoraAtual()">
    <nav class="navbar">
      <ul class="nav-container">
        <li><a onclick="showTab('tab-ponto')" id="link-ponto" class="active">Ponto</a></li>
        <li><a onclick="showTab('tab-licenca')" id="link-licenca">Licenças Gerais</a></li>
        <li><a onclick="showTab('tab-lic-arma')" id="link-lic-arma">Licença de Arma</a></li>
        <li><a onclick="showTab('tab-habitantes')" id="link-habitantes">Reg. Habitantes</a></li>
        <li><a onclick="showTab('tab-armas')" id="link-armas">Reg. Armas</a></li>
      </ul>
    </nav>

    <div id="tab-ponto" class="card active">
      <h2>Registro de Ponto</h2>
      <div class="form-group">
        <label>Informações do Oficial</label>
        <input type="text" id="ponto-nome" placeholder="Nome Completo" />
        <input type="text" id="ponto-patente" placeholder="Patente" style="margin-top: 8px" />
      </div>
      <h3>Entrada em Serviço</h3>
      <div class="form-group">
        <input type="text" id="localEntrada" placeholder="Localidade" />
        <div class="input-row">
          <input type="datetime-local" id="dataEntrada" />
          <button class="btn-now" onclick="setNow('dataEntrada')">Agora</button>
        </div>
      </div>
      <h3>Saída de Serviço</h3>
      <div class="form-group">
        <input type="text" id="localSaida" placeholder="Localidade" />
        <div class="input-row">
          <input type="datetime-local" id="dataSaida" />
          <button class="btn-now" onclick="setNow('dataSaida')">Agora</button>
        </div>
      </div>
      <div class="btn-group">
        <button class="main-btn btn-generate" onclick="gerarPonto()">Gerar</button>
        <button class="main-btn btn-copy" onclick="copiarSimples('res-ponto')">Copiar</button>
      </div>
      <textarea id="res-ponto" class="result-area" readonly></textarea>
    </div>

    <div id="tab-licenca" class="card">
      <h2>Registro de Licença</h2>
      <div class="form-group">
        <label>Proprietário</label>
        <input type="text" id="lic-nome" placeholder="Ex: Finn Reford" />
        <select id="lic-local">
          <option value="" selected>ESCOLHA A REGIÃO</option>
          <option value="New Hanover">New Hanover</option>
          <option value="New Austin">New Austin</option>
          <option value="West Elizabeth">West Elizabeth</option>
          <option value="Lemoyne">Lemoyne</option>
        </select>
      </div>
      <div class="form-group">
        <label>Dados da Licença</label>
        <select id="lic-tipo">
          <option value="CAÇADOR" selected>CAÇADOR</option>
          <option value="PORTE DE ARMA">PORTE DE ARMA</option>
          <option value="PESCA">PESCA</option>
        </select>
        <div class="input-row">
          <input type="text" id="lic-valor" placeholder="Ex: U$: 10,00" />
          <input type="text" id="lic-validade" value="Não Expira" />
        </div>
      </div>
      <div class="form-group">
        <label>Evidência Fotográfica</label>
        <div class="photo-area" onclick="pasteTarget='preview-licenca'; document.getElementById('file-lic').click()">
          <span id="label-lic">Clique ou Ctrl+V para a foto da Licença</span>
          <img id="preview-licenca" style="display:none" />
        </div>
        <input type="file" id="file-lic" style="display:none" onchange="handleFile(this, 'preview-licenca', 'label-lic')" />
      </div>
      <div class="btn-group">
        <button class="main-btn btn-generate" onclick="gerarLicenca()">Gerar</button>
        <button class="main-btn btn-copy" onclick="copiarComFoto('res-licenca', 'preview-licenca')">Copiar Texto + Foto</button>
      </div>
      <textarea id="res-licenca" class="result-area" readonly></textarea>
    </div>

    <div id="tab-lic-arma" class="card">
      <h2>Licença de Arma</h2>
      <div class="form-group">
        <label>Dados do Proprietário</label>
        <input type="text" id="la-nome" placeholder="Ex: Earving James" />
        <input type="text" id="la-id" placeholder="ID (Ex: 396)" style="margin-top: 8px" />
      </div>
      <div class="form-group">
        <label>Dados da Arma</label>
        <input type="text" id="la-modelo" placeholder="Modelo (Ex: Pistola M1899)" />
        <input type="text" id="la-serie" placeholder="Nº Série (Ex: 469446TJF989981)" style="margin-top: 8px" />
      </div>
      <div class="form-group">
        <label>Financeiro e Validade</label>
        <div class="input-row">
          <input type="text" id="la-valor" value="50$" />
          <input type="text" id="la-validade" value="30 DIAS" />
        </div>
      </div>
      <div class="form-group">
        <label>Evidência Fotográfica</label>
        <div class="photo-area" onclick="pasteTarget='preview-la'; document.getElementById('file-la').click()">
          <span id="label-la">Clique ou Ctrl+V para a foto</span>
          <img id="preview-la" style="display:none" />
        </div>
        <input type="file" id="file-la" style="display:none" onchange="handleFile(this, 'preview-la', 'label-la')" />
      </div>
      <div class="btn-group">
        <button class="main-btn btn-generate" onclick="gerarLicencaArma()">Gerar Registro</button>
        <button class="main-btn btn-copy" onclick="copiarComFoto('res-licarma', 'preview-la')">Copiar Texto + Foto</button>
      </div>
      <textarea id="res-licarma" class="result-area" readonly></textarea>
    </div>

    <div id="tab-habitantes" class="card">
      <h2>Registro de Habitantes</h2>
      <div class="form-group">
        <label>Dados do Habitante</label>
        <input type="text" id="hab-nome" placeholder="Ex: Finn Reford" />
        <div class="input-row">
          <input type="text" id="hab-id" placeholder="ID (Ex: 464)" />
          <input type="text" id="hab-idade" placeholder="Idade (Ex: 29 anos)" />
        </div>
      </div>
      <div class="form-group">
        <label>Foto do Rosto / Perfil</label>
        <div class="photo-area" onclick="pasteTarget='preview-hab'; document.getElementById('file-hab').click()">
          <span id="label-hab">Clique ou Ctrl+V para Foto do Rosto</span>
          <img id="preview-hab" style="display:none" />
        </div>
        <input type="file" id="file-hab" style="display:none" onchange="handleFile(this, 'preview-hab', 'label-hab')" />
      </div>
      <div class="btn-group">
        <button class="main-btn btn-generate" onclick="gerarHabitante()">Gerar Registro</button>
        <button class="main-btn btn-copy" onclick="copiarComFoto('res-hab', 'preview-hab')">Copiar Texto + Foto</button>
      </div>
      <textarea id="res-hab" class="result-area" readonly></textarea>
    </div>

    <div id="tab-armas" class="card">
      <h2>Registro de Armas</h2>
      <div class="form-group">
        <label>Proprietário</label>
        <input type="text" id="arm-nome" placeholder="Earving James" />
        <input type="text" id="arm-id" placeholder="ID (396)" style="margin-top: 8px" />
      </div>
      <div style="background: rgba(255,255,255,0.03); padding: 15px; border-radius: 8px; border: 1px solid var(--border);">
        <label>Adicionar Arma</label>
        <input type="text" id="arm-modelo" placeholder="Modelo (Ex: Pistola M1899)" />
        <input type="text" id="arm-serie" placeholder="N° Série" style="margin-top: 8px" />
        <button class="btn-add" onclick="adicionarArmaNaLista()">+ Adicionar à Lista</button>
      </div>
      <div id="lista-armas-preview"></div>
      <div class="form-group" style="margin-top: 20px;">
        <label>Foto do Registro</label>
        <div class="photo-area" onclick="pasteTarget='preview-arma'; document.getElementById('file-arma').click()">
          <span id="label-arma">Clique ou Ctrl+V para Foto</span>
          <img id="preview-arma" style="display:none" />
        </div>
        <input type="file" id="file-arma" style="display:none" onchange="handleFile(this, 'preview-arma', 'label-arma')" />
      </div>
      <div class="btn-group">
        <button class="main-btn btn-generate" onclick="gerarRegistroArmas()">Gerar Registro</button>
        <button class="main-btn btn-copy" onclick="copiarComFoto('res-armas', 'preview-arma')">Copiar Texto + Foto</button>
      </div>
      <textarea id="res-armas" class="result-area" readonly></textarea>
    </div>

    <div class="footer">Law Enforcement - Downtown v1.5 - 2026: Toolls.</div>

    <script>
      let pasteTarget = 'preview-la';
      let listaArmas = [];
      let currentBlob = null;

      function showTab(tabId) {
        document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.nav-container li a').forEach(a => a.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        document.getElementById('link-' + tabId.split('-')[1] + (tabId==='tab-lic-arma'?'-arma':'')).classList.add('active');
        if(tabId === 'tab-licenca') pasteTarget = 'preview-licenca';
        if(tabId === 'tab-lic-arma') pasteTarget = 'preview-la';
        if(tabId === 'tab-habitantes') pasteTarget = 'preview-hab';
        if(tabId === 'tab-armas') pasteTarget = 'preview-arma';
      }

      function setNow(id) {
        const agora = new Date();
        agora.setMinutes(agora.getMinutes() - agora.getTimezoneOffset());
        document.getElementById(id).value = agora.toISOString().slice(0, 16);
      }

      function definirHoraAtual() { setNow('dataEntrada'); }

      function handleFile(input, imgId, labelId) {
        if (input.files && input.files[0]) {
            currentBlob = input.files[0];
            displayImage(currentBlob, imgId, labelId);
        }
      }

      window.addEventListener('paste', e => {
        const items = e.clipboardData.items;
        for (let i = 0; i < items.length; i++) {
          if (items[i].type.indexOf('image') !== -1) {
            currentBlob = items[i].getAsFile();
            displayImage(currentBlob, pasteTarget, pasteTarget.replace('preview', 'label'));
          }
        }
      });

      function displayImage(file, imgId, labelId) {
        const reader = new FileReader();
        reader.onload = e => {
          const img = document.getElementById(imgId);
          img.src = e.target.result;
          img.style.display = 'block';
          document.getElementById(labelId).style.display = 'none';
        };
        reader.readAsDataURL(file);
      }

      function adicionarArmaNaLista() {
        const mod = document.getElementById('arm-modelo').value;
        const ser = document.getElementById('arm-serie').value;
        if(!mod || !ser) return alert("Preencha Modelo e Série!");
        listaArmas.push({ mod, ser });
        renderListaArmas();
        document.getElementById('arm-modelo').value = '';
        document.getElementById('arm-serie').value = '';
      }

      function renderListaArmas() {
        const container = document.getElementById('lista-armas-preview');
        container.innerHTML = listaArmas.map((a, i) => `
          <div class="arma-item">
            <b>${i+1}. ${a.mod}</b> | Série: ${a.ser}
          </div>
        `).join('');
      }

      // --- CORREÇÃO APLICADA AQUI NA FUNÇÃO GERAR PONTO ---
      function gerarPonto() {
        const n = document.getElementById("ponto-nome").value || "---";
        const p = document.getElementById("ponto-patente").value || "---";
        
        // Capturando as localidades
        const locEntrada = document.getElementById("localEntrada").value || "---";
        const locSaida = document.getElementById("localSaida").value || "---";

        const de = new Date(document.getElementById("dataEntrada").value);
        const ds = new Date(document.getElementById("dataSaida").value);
        
        // Formato __/__ - __:__
        const format = (d) => d instanceof Date && !isNaN(d) ? `${d.getDate().toString().padStart(2,'0')}/${(d.getMonth()+1).toString().padStart(2,'0')} - ${d.getHours().toString().padStart(2,'0')}:${d.getMinutes().toString().padStart(2,'0')}` : "__/__ - __:__";
        
        // Montando o template string exatamente como solicitado
        const textoFinal = `> ### **Registro de Ponto**\n> **Oficial:** ${n}\n> **Patente:** ${p}\n> ### **Entrada em Serviço**\n> **Localidade:** ${locEntrada}\n> **Data/Horário:** ${format(de)}\n> ### **Saída de Serviço**\n> **Localidade:** ${locSaida}\n> **Data/Horário:** ${format(ds)}`;

        document.getElementById("res-ponto").value = textoFinal;
      }
      // ----------------------------------------------------

      function gerarLicenca() {
        const local = document.getElementById('lic-local').value;
        if(!local) return alert("Selecione a Região!");
        const txt = `> ### **REGISTRO DE LICENÇA**\n> **Proprietário:** ${document.getElementById('lic-nome').value}\n> **Local:** ${local}\n> **Licença:** ${document.getElementById('lic-tipo').value}\n> **Valor:** ${document.getElementById('lic-valor').value}\n> **Validade:** ${document.getElementById('lic-validade').value}\n\n> **[EVIDÊNCIA FOTOGRÁFICA ANEXADA]**`;
        document.getElementById('res-licenca').value = txt;
      }

      function gerarLicencaArma() {
        const n = document.getElementById('la-nome').value;
        const id = document.getElementById('la-id').value;
        const mod = document.getElementById('la-modelo').value;
        const ser = document.getElementById('la-serie').value;
        const val = document.getElementById('la-valor').value;
        const exp = document.getElementById('la-validade').value;

        const txt = `> ### **LICENÇA DE ARMA**\n> **Nome:** ${n}\n> **ID:** ${id}\n> **Valor:** ${val}\n> **Modelo:** ${mod}\n> **Nº Série:** ${ser}\n> **Validade:** ${exp}`;
        document.getElementById('res-licarma').value = txt;
      }

      function gerarHabitante() {
        const txt = `> ### **REGISTRO DE HABITANTE**\n> **Nome:** ${document.getElementById('hab-nome').value}\n> **ID:** ${document.getElementById('hab-id').value}\n> **Idade:** ${document.getElementById('hab-idade').value}\n\n> **[FOTO DE RECONHECIMENTO ANEXADA]**`;
        document.getElementById('res-hab').value = txt;
      }

      function gerarRegistroArmas() {
        const nome = document.getElementById('arm-nome').value;
        const id = document.getElementById('arm-id').value;
        let txt = `> ### **REGISTRO DE ARMA**\n> **Nome:** ${nome}\n> **ID:** ${id}`;
        listaArmas.forEach(a => {
            txt += `\n> -------------------------\n> **Modelo:** ${a.mod}\n> **N° Série:** ${a.ser}`;
        });
        document.getElementById('res-armas').value = txt;
      }

      function copiarSimples(id) {
        const t = document.getElementById(id);
        navigator.clipboard.writeText(t.value);
        alert("Texto copiado!");
      }

      async function copiarComFoto(textId, imgId) {
        const text = document.getElementById(textId).value;
        const img = document.getElementById(imgId);
        if(!text) return alert("Gere o registro primeiro!");
        
        try {
          await navigator.clipboard.writeText(text);
          if (img.style.display !== 'none' && currentBlob) {
            const data = [new ClipboardItem({ [currentBlob.type]: currentBlob })];
            await navigator.clipboard.write(data);
            alert("Texto + Foto copiados! Vá ao Discord e dê Ctrl+V.");
          } else {
            alert("Texto copiado (sem foto)!");
          }
        } catch (e) {
            alert("Erro ao copiar foto automaticamente. Use o botão direito na imagem.");
        }
      }
    </script>
  </body>
</html>
